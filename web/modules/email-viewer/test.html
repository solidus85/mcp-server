<!DOCTYPE html>
<html>
<head>
    <title>Email Viewer Test</title>
    <script src="js/utils.js"></script>
    <script src="js/api-client.js"></script>
</head>
<body>
    <h1>Email Viewer Test</h1>
    <button onclick="testEmailLoading()">Test Email Loading</button>
    <pre id="output"></pre>
    
    <script>
        async function testEmailLoading() {
            const output = document.getElementById('output');
            output.textContent = 'Loading...\n';
            
            try {
                // Get thread emails
                const threadId = 'thread_1c615536';
                output.textContent += `\nFetching thread ${threadId}...\n`;
                const threadEmails = await apiClient.getThreadEmails(threadId);
                output.textContent += `Found ${threadEmails.length} emails in thread\n`;
                
                if (threadEmails.length > 0) {
                    const firstEmail = threadEmails[0];
                    output.textContent += `\nFirst email summary:\n`;
                    output.textContent += JSON.stringify(firstEmail, null, 2);
                    
                    // Load full details
                    output.textContent += `\n\nLoading full details for email ${firstEmail.id}...\n`;
                    const fullEmail = await apiClient.getEmail(firstEmail.id);
                    
                    output.textContent += `\nFull email details:\n`;
                    output.textContent += `Subject: ${fullEmail.subject}\n`;
                    output.textContent += `From: ${fullEmail.from || fullEmail.sender?.email || 'Unknown'}\n`;
                    output.textContent += `Has Body: ${!!fullEmail.body}\n`;
                    output.textContent += `Has Body Text: ${!!fullEmail.body_text}\n`;
                    output.textContent += `Recipients Count: ${fullEmail.recipients?.length || 0}\n`;
                    
                    if (fullEmail.recipients && fullEmail.recipients.length > 0) {
                        output.textContent += `\nRecipients:\n`;
                        fullEmail.recipients.forEach(r => {
                            output.textContent += `  - ${r.recipient_type}: ${r.person?.email || 'Unknown'}\n`;
                        });
                    }
                    
                    if (fullEmail.body || fullEmail.body_text) {
                        output.textContent += `\nEmail Content:\n`;
                        output.textContent += fullEmail.body_text || fullEmail.body || 'No content';
                    }
                }
            } catch (error) {
                output.textContent += `\nError: ${error.message}\n`;
                console.error(error);
            }
        }
    </script>
</body>
</html>